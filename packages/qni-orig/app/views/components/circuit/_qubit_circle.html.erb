<% ket = local_assigns.fetch(:ket) %>
<% magnitude = local_assigns.fetch(:magnitude) %>
<% magnitude_string = local_assigns.fetch(:magnitude_string, magnitude) %>
<% phase = magnitude.positive? ? local_assigns.fetch(:phase, 0) : nil %>
<% phase_string = local_assigns.fetch(:phase_string, phase) if phase %>
<% phase_klass = phase.positive? ? "rotate-#{phase}" : "-rotate#{phase}" if phase %>
<% klass = local_assigns[:class] %>

<% balloon_label = "|#{ket}âŸ©\nmagnitude = #{magnitude_string}" %>
<% balloon_label += "\nphase = #{phase_string}" if magnitude.positive? %>

<%= tag.div class: class_string('qubit-circle', klass => klass),
            data: { target: 'simulator.qubitCircle', magnitude: magnitude, balloon_pos: 'up', balloon_break: '' },
            aria: { label: balloon_label } do %>
  <div class="qubit-circle__border">
    <div class="qubit-circle__magnitude"></div>
    <% if magnitude.positive? %>
      <div class="absolute top-0 w-full h-full origin-center transform" style="--transform-rotate: <%= phase * -1 %>deg;">
        <div class="relative w-full h-full">
          <div class="qubit-circle__phase"></div>
          <dev class="qubit-circle__phase-magnitude"></dev>
          <div class="qubit-circle__phase-dot"></div>
        </div>
      </div>
    <% end %>
  </div>
  <span class="qubit-circle__ket">|<%= ket %>&#10217;</span>
<% end %>
