<% ket = local_assigns.fetch(:ket) %>
<% magnitude = local_assigns.fetch(:magnitude) %>
<% magnitude_string = local_assigns.fetch(:magnitude_string, magnitude.to_s).gsub('sqrt', '√').gsub(/√\((.)\)/, '√\1').gsub(/\s+/, '') %>
<% phase = magnitude.positive? ? local_assigns.fetch(:phase, 0) : nil %>
<% phase_string = local_assigns.fetch(:phase_string, phase.to_s).gsub('sqrt', '√').gsub(/√\((.)\)/, '√\1').gsub('pi', 'π').gsub(/\s+/, '') if phase %>
<% phase_klass = phase.positive? ? "rotate-#{phase}" : "-rotate#{phase}" if phase %>

<div class="qubit-circle"
     data-target="circle-notation.qubitCircle"
     data-target="simulator.qubitCircle"
     data-ket="<%= ket %>"
     data-magnitude="<%= magnitude %>"
     data-magnitude-string="<%= magnitude_string %>"
     data-phase-string="<%= phase_string %>">
  <div class="qubit-circle__tooltip hidden">
    <div class="text-center font-bold">|<%= ket %>&gt;</div>
    <div>M=<%= magnitude_string %></div>
    <% if magnitude.positive? %>
      <div>φ=<%= phase_string %></div>
    <% end %>
  </div>
  <div class="qubit-circle__border"></div>
  <div class="qubit-circle__body">
    <div class="qubit-circle__magnitude"></div>
    <% if magnitude.positive? %>
      <div class="qubit-circle__phase" style="--transform-rotate: <%= phase * -1 %>deg;">
        <div class="relative w-full h-full">
          <div class="qubit-circle__phase-line"></div>
          <dev class="qubit-circle__phase-magnitude"></dev>
          <div class="qubit-circle__phase-dot"></div>
        </div>
      </div>
    <% end %>
  </div>
  <span class="qubit-circle__ket">|<%= ket %>&#10217;</span>
</div>
