<% content_for :meta_ogp do %>
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= twitter_title %>">
  <% if @json %>
    <meta property="og:url" content="<%= circuit_url @json %>">
    <meta property="og:description" content="<%= og_description @json %>">
  <% end %>
  <% if @circuit&.social_image&.attached? %>
    <meta property="og:image" content="<%= rails_blob_url(@circuit.social_image, disposition: 'inline') %>">
  <% end %>
<% end %>

<quantum-simulator class="relative">
  <%= menu do %>
    <%= share_button %>
    <%= clear_circuit %>
  <% end %>

  <div id="palette" class="hidden md:flex flex-row space-x-2 fixed top-0 let-0 mt-14 mx-6 px-4 py-5 bg-snow rounded-md border-2 border-b-4 border-swan z-40">
    <palette-dropzone>
      <h-gate>
        <header>
          <h1>Hadamard Gate</h1>
          <p>Creates simple superpositions.</p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <h-gate data-size="sm"></h-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <h-gate data-size="sm"></h-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-phases="0,180" data-show-kets></circle-notation>
        </div>
      </h-gate>
    </palette-dropzone>

    <palette-dropzone>
      <x-gate>
        <header>
          <h1>NOT Gate (Pauli X Gate)</h1>
          <p>Swaps the qubit pair of <code>|0⟩</code> and <code>|1⟩</code>.</p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <x-gate data-size="sm"></x-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <x-gate data-size="sm"></x-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0.9,0.4" data-phases="340,70" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <x-gate data-size="sm"></x-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.4,0.9" data-phases="70,340" data-show-kets></circle-notation>
        </div>
      </x-gate>
    </palette-dropzone>

    <palette-dropzone>
      <y-gate>
        <header>
          <h1>Pauli Y Gate</h1>
          <p>The combination of the X and Z gates.</p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <y-gate data-size="sm"></y-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0,1" data-phases="0,90" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <y-gate data-size="sm"></y-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-phases="-90,0" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0.9,0.4" data-phases="340,70" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <y-gate data-size="sm"></y-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.4,0.9" data-phases="160,250" data-show-kets></circle-notation>
        </div>
      </y-gate>
    </palette-dropzone>

    <palette-dropzone>
      <z-gate>
        <header>
          <h1>Pauli Z Gate</h1>
          <p>Negate phases when the qubit is ON.</p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <z-gate data-size="sm"></z-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-show-kets></circle-notation>
        </div>

        <div class="mt-5 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <z-gate data-size="sm"></z-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0,1" data-phases="0,180" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0.9,0.4" data-phases="340,70" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <z-gate data-size="sm"></z-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.9,0.4" data-phases="340,250" data-show-kets></circle-notation>
        </div>
      </z-gate>
    </palette-dropzone>

    <palette-dropzone>
      <phase-gate data-phi="π/2">
        <header>
          <h1>Phase Gate</h1>
          <p>
            Applies a phase of e<sup>iφ</sup> to the <code>|1⟩</code> state.
          </p>
          <p>
            The default φ = π/2.
          </p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <phase-gate data-phi="π/2" data-size="sm"></phase-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-show-kets></circle-notation>
        </div>

        <div class="mt-5 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <phase-gate data-phi="π/2" data-size="sm"></phase-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0,1" data-phases="0,90" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0.9,0.4" data-phases="340,70" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <phase-gate data-phi="π/2" data-size="sm"></phase-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.9,0.4" data-phases="340,160" data-show-kets></circle-notation>
        </div>
      </phase-gate>
    </palette-dropzone>

    <palette-dropzone>
      <rnot-gate>
        <header>
          <h1>Square Root of NOT Gate</h1>
          <p>Rotates around the X-axis by <code>π/2</code>.</p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <rnot-gate data-size="sm"></rnot-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-phases="45,-45" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <rnot-gate data-size="sm"></rnot-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-phases="-45,45" data-show-kets></circle-notation>
        </div>
      </rnot-gate>
    </palette-dropzone>

    <palette-dropzone>
      <rx-gate data-theta="π/2">
        <header>
          <h1>Rx Gate</h1>
          <p>
            Rotates around the X-axis by the angle θ.
          </p>
          <p>
            The default θ = π/2.
          </p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <rx-gate data-theta="π/2" data-size="sm"></rx-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-phases="0,-90" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <rx-gate data-theta="π/2" data-size="sm"></rx-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-phases="-90,0" data-show-kets></circle-notation>
        </div>
      </rx-gate>
    </palette-dropzone>

    <palette-dropzone>
      <ry-gate data-theta="π/2">
        <header>
          <h1>Ry Gate</h1>
          <p>
            Rotates around the Y-axis by the angle θ.
          </p>
          <p>
            The default θ = π/2.
          </p>
        </header>

        <div class="mt-5 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <ry-gate data-theta="π/2" data-size="sm"></ry-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <ry-gate data-theta="π/2" data-size="sm"></ry-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0.7,0.7" data-phases="180,0" data-show-kets></circle-notation>
        </div>
      </ry-gate>
    </palette-dropzone>

    <palette-dropzone>
      <rz-gate data-theta="π/2">
        <header>
          <h1>Rz Gate</h1>
          <p>
            Rotates around the Z-axis by the angle θ.
          </p>
          <p>
            The default θ = π/2.
          </p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <rz-gate data-theta="π/2" data-size="sm"></rz-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-phases="-45,0" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <rz-gate data-theta="π/2" data-size="sm"></rz-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0,1" data-phases="0,45" data-show-kets></circle-notation>
        </div>
      </rz-gate>
    </palette-dropzone>

    <palette-dropzone>
      <swap-gate>
        <header>
          <h1>Swap Gate</h1>
          <p>Swap the values of two qubits.</p>
          <p>(Place two in the same column.)</p>
        </header>
      </swap-gate>
    </palette-dropzone>

    <palette-dropzone>
      <control-gate>
        <header>
          <h1>Control Gate</h1>
          <p>Conditions on a qubit being ON.</p>
          <p>Gates in the same column only apply to states meeting the condition.</p>
        </header>
      </control-gate>
    </palette-dropzone>

    <palette-dropzone>
      <bloch-display>
        <header>
          <h1>Bloch Sphere Display</h1>
          <p>Shows a wire's local state as a point on the Bloch sphere.</p>
        </header>
      </bloch-display>
    </palette-dropzone>

    <palette-dropzone>
      <write-gate data-value="0">
        <header>
          <h1><code>|0⟩</code> Operation</h1>
          <p>(Re)sets a qubit to state <code>|0⟩</code>.</p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <write-gate data-value="0" data-size="sm"></write-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <write-gate data-value="0" data-size="sm"></write-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-show-kets></circle-notation>
        </div>
      </write-gate>
    </palette-dropzone>

    <palette-dropzone>
      <write-gate data-value="1">
        <header>
          <h1><code>|1⟩</code> Operation</h1>
          <p>(Re)sets a qubit to state <code>|1⟩</code>.</p>
        </header>

        <div class="mt-4 flex flex-row items-center space-x-1">
          <circle-notation data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <write-gate data-value="1" data-size="sm"></write-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
        </div>

        <div class="mt-5 mb-6 flex flex-row items-center space-x-1">
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
          <div class="flex flex-row items-center">
            <%= icon :minus %>
            <write-gate data-value="1" data-size="sm"></write-gate>
            <%= icon :arrow_right %>
          </div>
          <circle-notation data-magnitudes="0,1" data-show-kets></circle-notation>
        </div>
      </write-gate>
    </palette-dropzone>

    <palette-dropzone>
      <measurement-gate>
        <header>
          <h1>Measurement Gate</h1>
          <p>Measures whether a qubit is ON or OFF.</p>
        </header>
      </measurement-gate>
    </palette-dropzone>
  </div>

  <quantum-circuit class="block my-56 md:my-52 md:ml-6"
                   data-update-url
                   data-min-wire-count="2"
                   data-min-step-count="5">
  </quantum-circuit>

  <%= render GatePopupComponent.new(type: 'theta', label: 'θ', error_message: 'Invalid θ value') %>
  <%= render GatePopupComponent.new(type: 'phi', label: 'φ', error_message: 'Invalid φ value') %>
  <%= render GatePopupComponent.new(type: 'if', label: 'if', error_message: 'Invalid `if` value') %>
  <%= render GatePopupComponent.new(type: 'flag', label: 'flag', error_message: 'Invalid flag') %>

  <circle-notation id="circle-notation"
                   class="circle-notation flex flex-row justify-center fixed top-0 md:top-auto left-0 md:left-auto right-0 md:right-auto mt-12 md:mt-0 mx-6 md:mx-0 md:bottom-0 w-auto h-32 md:h-auto overflow-y-auto mb-8 bg-snow border-2 border-b-4 border-swan rounded-md md:left-1/2 md:transform md:-translate-x-1/2 z-40"
                   data-target="quantum-simulator.circleNotation"
                   data-multi-qubits>
    <template id="circle-notation-popup">
      <div class="text-base text-wolf mb-2">
        |<span class="circle-notation-popup__ket-binary font-mono"></span>⟩ (decimal <span class="circle-notation-popup__ket-decimal"></span>)
      </div>
      <ul class="list-none">
        <li>
          Amplitude: <span class="circle-notation-popup__amplitude-real font-bold font-mono text-eel"></span>
          <span class="circle-notation-popup__amplitude-imag font-bold font-mono text-eel"></span>
        </li>
        <li>
          Probability: <span class="circle-notation-popup__probability font-bold font-mono text-eel"></span>
        </li>
        <li>
          Phase: <span class="circle-notation-popup__phase font-bold font-mono text-eel"></span>
        </li>
      </ul>
    </template>
  </circle-notation>

  <run-circuit-button class="fixed bottom-0 right-0 mr-6 mb-6 md:mb-8 z-40"></run-circuit-button>
</quantum-simulator>
